<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Submarine Control Dashboard</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      overflow: hidden;
    }
    .dashboard {
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
      text-align: center;
      width: 90%;
      max-width: 400px;
      position: relative;
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 20px;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
    }
    .drive-controls {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .drive-controls .left {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .drive-controls .right {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .drive-controls button {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 1.5rem;
      width: 80px;
      height: 80px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .drive-controls button:active {
      background: rgba(255, 255, 255, 0.4);
    }
    .yoke {
      margin-top: 20px;
      width: 100%;
      height: 150px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 30px;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }
    .yoke-stick {
      width: 60px;
      height: 60px;
      background: white;
      border-radius: 50%;
      cursor: pointer;
      position: absolute;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s ease;
    }
    .lock-button {
      margin-top: 10px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 1rem;
      padding: 10px 20px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .lock-button:active {
      background: rgba(255, 255, 255, 0.4);
    }
    .light-control {
      margin-top: 20px;
      font-size: 3rem;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .light-control.on {
      color: #ffeb3b;
      text-shadow: 0 0 10px #ffeb3b;
    }
    .status {
      margin-top: 20px;
      font-size: 1.2rem;
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <h1>Submarine Control</h1>
    <div class="drive-controls">
      <div class="left">
        <button id="forward">‚¨ÜÔ∏è</button>
        <button id="backward">‚¨áÔ∏è</button>
      </div>
      <div class="right">
        <button id="left">‚¨ÖÔ∏è</button>
        <button id="right">‚û°Ô∏è</button>
      </div>
    </div>
    <div class="yoke">
      <div class="yoke-stick" id="yoke-stick"></div>
    </div>
    <button class="lock-button" id="lock">Lock</button>
    <div class="light-control" id="light">üí°</div>
    <div class="status" id="status">Status: Idle</div>
  </div>

  <script>
    const baseUrl = "http://172.16.12.103"; // Replace with your ESP32 IP address
    const yokeStick = document.getElementById("yoke-stick");
    const status = document.getElementById("status");
    const light = document.getElementById("light");
    const lockButton = document.getElementById("lock");

    let isLocked = false;
    let yokeValue = 0;

    // Yoke control logic
    yokeStick.addEventListener("mousedown", startDrag);
    yokeStick.addEventListener("touchstart", startDrag);

    function startDrag(e) {
      e.preventDefault();
      document.addEventListener("mousemove", drag);
      document.addEventListener("touchmove", drag);
      document.addEventListener("mouseup", stopDrag);
      document.addEventListener("touchend", stopDrag);
    }

    function drag(e) {
      const rect = yokeStick.parentElement.getBoundingClientRect();
      let y = (e.clientY || e.touches[0].clientY) - rect.top;

      // Constrain yoke within the container
      y = Math.max(0, Math.min(150, y));
      yokeStick.style.transform = `translateY(${y - 75}px)`;

      // Determine yoke value (-1 to 1)
      yokeValue = (y - 75) / 75;
      sendCommand(yokeValue > 0 ? "float" : "sink");
    }

    function stopDrag() {
      document.removeEventListener("mousemove", drag);
      document.removeEventListener("touchmove", drag);
      yokeStick.style.transform = "translateY(0)";
      sendCommand("stop");
    }

    // Drive controls logic
    document.querySelectorAll(".drive-controls button").forEach(button => {
      button.addEventListener("mousedown", () => sendCommand(button.id));
      button.addEventListener("touchstart", () => sendCommand(button.id));
      button.addEventListener("mouseup", () => !isLocked && sendCommand("stop"));
      button.addEventListener("touchend", () => !isLocked && sendCommand("stop"));
    });

    // Lock button logic
    lockButton.addEventListener("click", () => {
      isLocked = !isLocked;
      lockButton.innerText = isLocked ? "Unlock" : "Lock";
    });

    // Light control logic
    light.addEventListener("click", () => {
      light.classList.toggle("on");
      sendCommand(light.classList.contains("on") ? "ledon" : "ledoff");
    });

    async function sendCommand(command) {
      const response = await fetch(`${baseUrl}/${command}`);
      const data = await response.text();
      status.innerText = `Status: ${data}`;
    }
  </script>
</body>
</html>